# 概述

## 基本概念

### 画布

#### 坐标系

### 颜色模型

#### 减色法模型

#### 加色法模型

### 颜色表示

# 光线追踪

## 基本概念

## 追踪射线

## 光

## 光源

### 点光

### 方向光

### 环境光

### 单点光照

## 漫反射

### 建模

#### Lambert漫反射模型

### 计算

### 渲染

漫反射是指光线击中物体表面后以不同方向均匀地散射。这种散射是所有方向上的，而不是像镜面反射那样有特定的反射角度（可以被近似为一种均匀散射的光源）。光线追踪中，通常使用兰伯特定律来描述漫反射，该定律说明了光线在哑光表面上的散射强度与入射角度的余弦成正比。

我们观察到物体的颜色大多数是基于漫反射，而那些非常晃眼的或者非常光亮的样品表面大多数是镜面反射和漫反射同时存在。

光线的相互作用可以被分解为不同的成分：漫反射是光线均匀地散射在表面上，而镜面反射则是在特定方向上发生的精确反射。

在光照计算中，我们使用相加关系是因为光线在不同方向上的反射并不会相互影响。换句话说，光线在表面上同时发生漫反射和镜面反射，并且这两种反射并不会相互减弱。因此，我们将它们视作独立的光照分量，将它们的贡献相加以得到最终的总光照。

为了正确模拟物体的外观和光照效果，漫反射在光照计算中占据了重要的位置。即使对于不具有镜面反射特性的物体，漫反射也会使物体在不同角度和光线条件下呈现出不同的亮度和色彩。

尽管漫反射和镜面反射可以视为同一束光线在表面上不同粗糙度下的反射结果，但在光照计算中，我们独立考虑它们是因为：

- **计算简化：** 漫反射和镜面反射的计算方式和影响因素不同，将它们分开计算可以简化模型并提高计算效率。
- **模拟真实效果：** 将漫反射和镜面反射作为独立的光照分量有助于更准确地模拟物体在不同光照条件下的外观，使渲染结果更接近真实世界中物体表面的反射特性。

其实将出射光分为 漫反射+镜面反射+透射 严格意义上并不准确。更精确的描述应该是 多次反射+单次反射 + 透射，而漫反射仅仅是对多次反射（包括在上表面多次反弹后反射+次表面多次反弹后从上表面出射）的近似，Ref. <Multiple-Scattering Microfacet BSDFs with the Smith Model>, SIGGRAPH 2016。

现在的图形渲染中比较流行的是基于微面元的BRDF模型，它假定物体的微观表面由很多个微小面元构成，而每个微小面元绝对光滑。在此前提下（绝对光滑），才可以使用菲涅尔公式进行计算。

当光入射到表面上某个微面时，发生菲涅尔反射，反射光可能直接离开表面，形成单次反射，对应问题中镜面反射。反射光也有可能继续和相邻的微面元发生一次或者多次碰撞后离开表面，形成多次反射。当然，如果入射光经过透射之后，进入表面，经过若干次在表面内部的反射之后，从上表面离开表面，这部分也对多次散射形成贡献。

对于多次散射的相对精确的计算较为复杂，可参考上述参文。同时，因为多次反射可能将光散射到各个方向，因此，一般使用Lambertian漫反射模型去近似多次散射。但是笔者进行过仿真实验，实验结果表明，多次散射的分布并不是人们认为的“呈漫反射分布”的形态，上述参文中也有对应的图示。

说到这里，似乎漫反射的系数（1-F）也好理解了：既是，非直接使用菲涅尔反射的部分。不过这部分既然已经是近似，没必要深究了。

道理上，加上多次散射（漫反射）确实是对能量进行了补偿，否则，在渲染粗糙度较高的物体时会明显出现物体较暗的情况。

## 镜面反射

